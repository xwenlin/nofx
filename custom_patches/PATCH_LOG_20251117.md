# è¡¥ä¸æ—¥å¿— 2025-11-17 (Patch Log 2025-11-17)

æœ¬æ–‡ä»¶è®°å½•2025å¹´11æœˆ17æ—¥çš„æ‰€æœ‰è‡ªå®šä¹‰è¡¥ä¸å’Œä¿®å¤çš„è¯¦ç»†ä¿¡æ¯ã€‚

---

## 2025-11-17 - å®žçŽ°äº‹ä»¶é©±åŠ¨å†³ç­–æœºåˆ¶ï¼Œè§£å†³å†³ç­–æ»žåŽé—®é¢˜

### é—®é¢˜æè¿°

#### æ ¸å¿ƒé—®é¢˜ï¼šå†³ç­–æ»žåŽå¯¼è‡´äº¤æ˜“æ—¶æœºå»¶è¯¯
- **é—®é¢˜**: ç³»ç»Ÿä½¿ç”¨å®šæ—¶å™¨æ¯3åˆ†é’Ÿè§¦å‘ä¸€æ¬¡å†³ç­–ï¼Œå¯èƒ½å·²ç»æ¯”ä¿¡å·çš„å®žé™…å‘ç”Ÿæ—¶é—´æ™šäº†æ•°ç§’åˆ°3åˆ†é’Ÿ
- **åœºæ™¯**: 
  - å¸‚åœºä¿¡å·åœ¨3åˆ†é’ŸKçº¿å‘¨æœŸçš„ä»»æ„æ—¶åˆ»å‘ç”Ÿï¼ˆä¾‹å¦‚ç¬¬1åˆ†é’Ÿï¼‰
  - ä½†ç³»ç»Ÿè¦ç­‰åˆ°ä¸‹ä¸€ä¸ª3åˆ†é’Ÿå®šæ—¶å™¨è§¦å‘ï¼ˆå¯èƒ½åœ¨ç¬¬3åˆ†é’Ÿï¼‰æ‰ä¼šå†³ç­–
  - æ­¤æ—¶å¸‚åœºå¯èƒ½å·²ç»æœç€ä¸åˆ©äºŽäº¤æ˜“çš„æ–¹å‘ç§»åŠ¨
- **å½±å“**: 
  - å†³ç­–å»¶è¿Ÿï¼šæœ€å¤šå¯èƒ½å»¶è¿Ÿ0-3åˆ†é’Ÿ
  - é”™è¿‡æœ€ä½³å…¥åœºæ—¶æœº
  - å¸‚åœºå·²ä¸åˆ©æ—¶ä»æŒ‰æ—§ä¿¡å·å†³ç­–ï¼Œå¢žåŠ äº¤æ˜“é£Žé™©
  - é™ä½Žäº¤æ˜“ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œç«žäº‰åŠ›

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆè®¾è®¡ï¼šäº‹ä»¶é©±åŠ¨ + å®šæ—¶å™¨å…œåº•

é‡‡ç”¨**äº‹ä»¶é©±åŠ¨æœºåˆ¶**ï¼Œå½“æ£€æµ‹åˆ°æ–°çš„3åˆ†é’ŸKçº¿å½¢æˆæ—¶ç«‹å³è§¦å‘å†³ç­–ï¼ŒåŒæ—¶ä¿ç•™å®šæ—¶å™¨ä½œä¸ºå…œåº•æœºåˆ¶ã€‚

**æ ¸å¿ƒæ€è·¯**ï¼š
1. **äº‹ä»¶é©±åŠ¨**ï¼šæ–°3åˆ†é’ŸKçº¿å½¢æˆæ—¶ç«‹å³è§¦å‘å†³ç­–
2. **é˜²æŠ–æœºåˆ¶**ï¼šé¿å…åŒä¸€æ ¹Kçº¿é‡å¤è§¦å‘ï¼Œæœ€å°è§¦å‘é—´éš”10ç§’
3. **å®šæ—¶å™¨å…œåº•**ï¼šä¿ç•™3åˆ†é’Ÿå®šæ—¶å™¨ï¼Œé˜²æ­¢WebSocketäº‹ä»¶ä¸¢å¤±
4. **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨äº’æ–¥é”ä¿æŠ¤å…±äº«çŠ¶æ€

### å®žçŽ°ç»†èŠ‚

#### 1. WSMonitor å›žè°ƒæœºåˆ¶ (`market/monitor.go`)

**æ–°å¢žå†…å®¹**ï¼š
- æ·»åŠ  `OnNewKlineCallback` å›žè°ƒå‡½æ•°ç±»åž‹
  ```go
  type OnNewKlineCallback func(symbol string, kline Kline, duration string)
  ```

- åœ¨ `WSMonitor` ç»“æž„ä½“ä¸­æ·»åŠ ï¼š
  - `onNewKlineCb OnNewKlineCallback` - å›žè°ƒå‡½æ•°
  - `cbMutex sync.RWMutex` - ä¿æŠ¤å›žè°ƒå‡½æ•°çš„è¯»å†™é”

- å®žçŽ° `SetOnNewKlineCallback()` æ–¹æ³•ç”¨äºŽæ³¨å†Œ/æ¸…é™¤å›žè°ƒ

- ä¿®æ”¹ `processKlineUpdate()` æ–¹æ³•ï¼š
  - æ£€æµ‹æ–°Kçº¿å½¢æˆï¼ˆé€šè¿‡æ¯”è¾ƒOpenTimeï¼‰
  - å½“æ£€æµ‹åˆ°æ–°çš„3åˆ†é’ŸKçº¿æ—¶ï¼Œå¼‚æ­¥è§¦å‘å›žè°ƒ
  - ä½¿ç”¨goroutineå¼‚æ­¥è°ƒç”¨ï¼Œé¿å…é˜»å¡žKçº¿æ›´æ–°å¤„ç†
  - æ·»åŠ panicæ¢å¤æœºåˆ¶ï¼Œç¡®ä¿å›žè°ƒå‡½æ•°å¼‚å¸¸ä¸å½±å“Kçº¿æ›´æ–°

**å…³é”®ä»£ç **ï¼š
```go
// å¦‚æžœæ˜¯æ–°çš„3åˆ†é’ŸKçº¿ï¼Œè§¦å‘å›žè°ƒï¼ˆäº‹ä»¶é©±åŠ¨å†³ç­–ï¼‰
if isNewKline && _time == "3m" {
    m.cbMutex.RLock()
    cb := m.onNewKlineCb
    m.cbMutex.RUnlock()
    if cb != nil {
        // å¼‚æ­¥è°ƒç”¨å›žè°ƒï¼Œé¿å…é˜»å¡žKçº¿æ›´æ–°å¤„ç†
        go func() {
            defer func() {
                if r := recover(); r != nil {
                    log.Printf("âš ï¸  æ–°Kçº¿å›žè°ƒå‡½æ•°panic: %v", r)
                }
            }()
            cb(symbol, kline, _time)
        }()
    }
}
```

#### 2. AutoTrader äº‹ä»¶å¤„ç† (`trader/auto_trader.go`)

**æ–°å¢žå­—æ®µ**ï¼š
- `processedKlines sync.Map` - é˜²æŠ–ç¼“å­˜ï¼šè®°å½•å·²å¤„ç†çš„Kçº¿OpenTime (symbol -> map[int64]bool)
- `lastEventTriggerTime time.Time` - ä¸Šæ¬¡äº‹ä»¶è§¦å‘æ—¶é—´ï¼ˆç”¨äºŽé˜²æŠ–ï¼‰
- `eventTriggerMutex sync.Mutex` - ä¿æŠ¤äº‹ä»¶è§¦å‘ç›¸å…³å­—æ®µ

**æ–°å¢žæ–¹æ³•**ï¼š
- `handleNewKlineEvent()` - å¤„ç†æ–°Kçº¿å½¢æˆäº‹ä»¶

**é˜²æŠ–æœºåˆ¶å®žçŽ°**ï¼š
1. **Kçº¿åŽ»é‡**ï¼šæ£€æŸ¥æ˜¯å¦å·²å¤„ç†è¿‡è¯¥Kçº¿ï¼ˆé€šè¿‡OpenTimeï¼‰
2. **æœ€å°é—´éš”**ï¼šè‡³å°‘é—´éš”10ç§’ï¼Œé¿å…è¿‡äºŽé¢‘ç¹è§¦å‘
3. **å‘¨æœŸæ£€æŸ¥**ï¼šå¦‚æžœå‘¨æœŸæ­£åœ¨æ‰§è¡Œï¼Œè·³è¿‡æœ¬æ¬¡è§¦å‘

**å…³é”®ä»£ç **ï¼š
```go
func (at *AutoTrader) handleNewKlineEvent(symbol string, kline market.Kline, duration string) {
    // é˜²æŠ–æ£€æŸ¥ï¼šé¿å…åŒä¸€æ ¹Kçº¿è§¦å‘å¤šæ¬¡å†³ç­–
    at.eventTriggerMutex.Lock()
    
    // æ£€æŸ¥æ˜¯å¦å·²ç»å¤„ç†è¿‡è¿™æ ¹Kçº¿
    // ... é˜²æŠ–é€»è¾‘ ...
    
    // æ£€æŸ¥æœ€å°è§¦å‘é—´éš”ï¼ˆé˜²æŠ–ï¼šè‡³å°‘é—´éš”10ç§’ï¼‰
    const minEventInterval = 10 * time.Second
    // ... é—´éš”æ£€æŸ¥ ...
    
    // æ£€æŸ¥å‘¨æœŸæ˜¯å¦æ­£åœ¨æ‰§è¡Œ
    // ... å‘¨æœŸæ£€æŸ¥ ...
    
    // è§¦å‘å†³ç­–å‘¨æœŸ
    if err := at.runCycle(); err != nil {
        log.Printf("âŒ äº‹ä»¶é©±åŠ¨å†³ç­–æ‰§è¡Œå¤±è´¥: %v", err)
    }
}
```

#### 3. é›†æˆåˆ°è¿è¡Œå¾ªçŽ¯

**ä¿®æ”¹ `Run()` æ–¹æ³•**ï¼š
- åœ¨å¯åŠ¨æ—¶æ³¨å†Œå›žè°ƒå‡½æ•°
- ä¿ç•™å®šæ—¶å™¨ä½œä¸ºå…œåº•æœºåˆ¶
- æ·»åŠ æ—¥å¿—è¾“å‡ºï¼Œè¯´æ˜Žäº‹ä»¶é©±åŠ¨å’Œå®šæ—¶å™¨å…œåº•æœºåˆ¶

**ä¿®æ”¹ `Stop()` æ–¹æ³•**ï¼š
- æ¸…é™¤å›žè°ƒå‡½æ•°ï¼Œé¿å…å†…å­˜æ³„æ¼

**å…³é”®ä»£ç **ï¼š
```go
// æ³¨å†Œæ–°Kçº¿å›žè°ƒï¼ˆäº‹ä»¶é©±åŠ¨å†³ç­–ï¼‰
if market.WSMonitorCli != nil {
    market.WSMonitorCli.SetOnNewKlineCallback(at.handleNewKlineEvent)
    log.Println("âœ… å·²å¯ç”¨äº‹ä»¶é©±åŠ¨å†³ç­–ï¼šæ–°3åˆ†é’ŸKçº¿å½¢æˆæ—¶å°†ç«‹å³è§¦å‘å†³ç­–")
} else {
    log.Println("âš ï¸  WSMonitoræœªåˆå§‹åŒ–ï¼Œäº‹ä»¶é©±åŠ¨å†³ç­–ä¸å¯ç”¨ï¼Œå°†ä»…ä½¿ç”¨å®šæ—¶å™¨")
}

// ä¿ç•™å®šæ—¶å™¨ä½œä¸ºå…œåº•æœºåˆ¶ï¼ˆé˜²æ­¢WebSocketäº‹ä»¶ä¸¢å¤±ï¼‰
ticker := time.NewTicker(at.config.ScanInterval)
defer ticker.Stop()
log.Printf("â° å®šæ—¶å™¨å…œåº•æœºåˆ¶å·²å¯ç”¨ï¼ˆé—´éš”: %vï¼‰ï¼Œç¡®ä¿å³ä½¿äº‹ä»¶ä¸¢å¤±ä¹Ÿèƒ½å®šæœŸå†³ç­–", at.config.ScanInterval)
```

### å·¥ä½œæµç¨‹

```
WebSocketæŽ¥æ”¶Kçº¿æ•°æ®
    â†“
processKlineUpdate() æ£€æµ‹åˆ°æ–°3åˆ†é’ŸKçº¿
    â†“
è§¦å‘å›žè°ƒ handleNewKlineEvent()
    â†“
é˜²æŠ–æ£€æŸ¥ï¼ˆå·²å¤„ç†ï¼Ÿé—´éš”è¶³å¤Ÿï¼Ÿå‘¨æœŸæ‰§è¡Œä¸­ï¼Ÿï¼‰
    â†“
é€šè¿‡æ£€æŸ¥ â†’ ç«‹å³è§¦å‘ runCycle() å†³ç­–
    â†“
åŒæ—¶ä¿ç•™å®šæ—¶å™¨å…œåº•ï¼ˆæ¯3åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
```

### é¢„æœŸæ•ˆæžœ

#### æ€§èƒ½æå‡
- **å†³ç­–å»¶è¿Ÿ**ï¼šä»Žæœ€å¤š3åˆ†é’Ÿé™ä½Žåˆ°æ•°ç§’å†…ï¼ˆæ–°Kçº¿å½¢æˆåŽç«‹å³è§¦å‘ï¼‰
- **å“åº”é€Ÿåº¦**ï¼šå¸‚åœºä¿¡å·å‡ºçŽ°åŽèƒ½æ›´å¿«å“åº”
- **äº¤æ˜“æ—¶æœº**ï¼šèƒ½å¤Ÿæ•æ‰åˆ°æ›´å‡†ç¡®çš„å…¥åœºæ—¶æœº

#### ç¨³å®šæ€§ä¿éšœ
- **å…¼å®¹æ€§**ï¼šä¿ç•™å®šæ—¶å™¨å…œåº•ï¼ŒWebSocketå¤±è´¥æ—¶ä»å¯ç”¨
- **é˜²æŠ–æœºåˆ¶**ï¼šé¿å…è¿‡åº¦é¢‘ç¹è§¦å‘ï¼Œä¿æŠ¤ç³»ç»Ÿèµ„æº
- **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨äº’æ–¥é”ä¿æŠ¤å…±äº«çŠ¶æ€

### æ—¥å¿—è¾“å‡º

ç³»ç»Ÿä¼šè¾“å‡ºä»¥ä¸‹å…³é”®æ—¥å¿—ï¼š

**å¯åŠ¨æ—¶**ï¼š
- `âœ… å·²å¯ç”¨äº‹ä»¶é©±åŠ¨å†³ç­–ï¼šæ–°3åˆ†é’ŸKçº¿å½¢æˆæ—¶å°†ç«‹å³è§¦å‘å†³ç­–`
- `â° å®šæ—¶å™¨å…œåº•æœºåˆ¶å·²å¯ç”¨ï¼ˆé—´éš”: 3m0sï¼‰ï¼Œç¡®ä¿å³ä½¿äº‹ä»¶ä¸¢å¤±ä¹Ÿèƒ½å®šæœŸå†³ç­–`

**äº‹ä»¶è§¦å‘æ—¶**ï¼š
- `âš¡ äº‹ä»¶é©±åŠ¨ï¼šæ£€æµ‹åˆ°æ–°3åˆ†é’ŸKçº¿å½¢æˆ [SYMBOL] OpenTime: XXXï¼Œç«‹å³è§¦å‘å†³ç­–`

**é˜²æŠ–è§¦å‘æ—¶**ï¼š
- `â¸ äº‹ä»¶è§¦å‘è¿‡äºŽé¢‘ç¹ï¼ˆè·ç¦»ä¸Šæ¬¡ X ç§’ï¼‰ï¼Œè·³è¿‡æœ¬æ¬¡è§¦å‘ï¼ˆé˜²æŠ–ï¼‰`
- `â¸ å‘¨æœŸæ­£åœ¨æ‰§è¡Œä¸­ï¼Œè·³è¿‡äº‹ä»¶è§¦å‘ï¼ˆç­‰å¾…å½“å‰å‘¨æœŸå®Œæˆï¼‰`

**å®šæ—¶å™¨å…œåº•**ï¼š
- `â° å®šæ—¶å™¨è§¦å‘å†³ç­–ï¼ˆå…œåº•æœºåˆ¶ï¼‰`

### æ–‡ä»¶ä¿®æ”¹æ¸…å•

#### ä¿®æ”¹çš„æ–‡ä»¶
1. **market/monitor.go**
   - æ·»åŠ  `OnNewKlineCallback` å›žè°ƒå‡½æ•°ç±»åž‹
   - åœ¨ `WSMonitor` ç»“æž„ä½“ä¸­æ·»åŠ å›žè°ƒç›¸å…³å­—æ®µ
   - å®žçŽ° `SetOnNewKlineCallback()` æ–¹æ³•
   - ä¿®æ”¹ `processKlineUpdate()` æ–¹æ³•ï¼Œæ£€æµ‹æ–°Kçº¿å¹¶è§¦å‘å›žè°ƒ

2. **trader/auto_trader.go**
   - åœ¨ `AutoTrader` ç»“æž„ä½“ä¸­æ·»åŠ é˜²æŠ–ç›¸å…³å­—æ®µ
   - å®žçŽ° `handleNewKlineEvent()` äº‹ä»¶å¤„ç†å‡½æ•°
   - ä¿®æ”¹ `Run()` æ–¹æ³•ï¼Œæ³¨å†Œå›žè°ƒå¹¶ä¿ç•™å®šæ—¶å™¨å…œåº•
   - ä¿®æ”¹ `Stop()` æ–¹æ³•ï¼Œæ¸…é™¤å›žè°ƒ

### æµ‹è¯•å»ºè®®

#### åŠŸèƒ½æµ‹è¯•
1. **äº‹ä»¶è§¦å‘æµ‹è¯•**ï¼š
   - è§‚å¯Ÿæ–°3åˆ†é’ŸKçº¿å½¢æˆæ—¶æ˜¯å¦ç«‹å³è§¦å‘å†³ç­–
   - éªŒè¯æ—¥å¿—è¾“å‡ºæ˜¯å¦æ­£ç¡®

2. **é˜²æŠ–æµ‹è¯•**ï¼š
   - éªŒè¯åŒä¸€æ ¹Kçº¿ä¸ä¼šé‡å¤è§¦å‘
   - éªŒè¯æœ€å°é—´éš”10ç§’æ˜¯å¦ç”Ÿæ•ˆ
   - éªŒè¯å‘¨æœŸæ‰§è¡Œä¸­æ—¶æ˜¯å¦è·³è¿‡è§¦å‘

3. **å…œåº•æœºåˆ¶æµ‹è¯•**ï¼š
   - æ¨¡æ‹ŸWebSocketå¤±è´¥åœºæ™¯
   - éªŒè¯å®šæ—¶å™¨æ˜¯å¦æ­£å¸¸è§¦å‘å†³ç­–

4. **å¹¶å‘æµ‹è¯•**ï¼š
   - éªŒè¯å¤šæ ¹Kçº¿åŒæ—¶å½¢æˆæ—¶çš„å¤„ç†
   - éªŒè¯äº‹ä»¶è§¦å‘å’Œå®šæ—¶å™¨è§¦å‘ä¸ä¼šå†²çª

#### æ€§èƒ½æµ‹è¯•
- ç›‘æŽ§äº‹ä»¶è§¦å‘é¢‘çŽ‡
- ç›‘æŽ§å†³ç­–æ‰§è¡Œæ—¶é—´
- éªŒè¯ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

### æ³¨æ„äº‹é¡¹

1. **å›žè°ƒå‡½æ•°å¼‚å¸¸å¤„ç†**ï¼šå›žè°ƒå‡½æ•°ä½¿ç”¨goroutineå¼‚æ­¥æ‰§è¡Œï¼Œå¹¶åŒ…å«panicæ¢å¤æœºåˆ¶ï¼Œç¡®ä¿å¼‚å¸¸ä¸å½±å“Kçº¿æ›´æ–°

2. **é˜²æŠ–é—´éš”**ï¼šå½“å‰è®¾ç½®ä¸º10ç§’ï¼Œå¯æ ¹æ®å®žé™…éœ€æ±‚è°ƒæ•´

3. **å®šæ—¶å™¨é—´éš”**ï¼šä¿ç•™åŽŸæœ‰çš„ `ScanInterval` é…ç½®ï¼ˆé»˜è®¤3åˆ†é’Ÿï¼‰ï¼Œä½œä¸ºå…œåº•æœºåˆ¶

4. **å†…å­˜ç®¡ç†**ï¼šé˜²æŠ–ç¼“å­˜ä½¿ç”¨ `sync.Map`ï¼Œä¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œä½†é•¿æœŸè¿è¡Œå¯èƒ½éœ€è¦è€ƒè™‘æ¸…ç†æ—§æ•°æ®

5. **WebSocketä¾èµ–**ï¼šäº‹ä»¶é©±åŠ¨æœºåˆ¶ä¾èµ–WebSocketæ­£å¸¸å·¥ä½œï¼Œå¦‚æžœWebSocketå¤±è´¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›žé€€åˆ°å®šæ—¶å™¨æ¨¡å¼

### åŽç»­ä¼˜åŒ–å»ºè®®

1. **é˜²æŠ–ç¼“å­˜æ¸…ç†**ï¼šè€ƒè™‘å®šæœŸæ¸…ç†æ—§çš„Kçº¿è®°å½•ï¼Œé¿å…å†…å­˜å ç”¨è¿‡å¤§
2. **å¯é…ç½®é˜²æŠ–é—´éš”**ï¼šå°†10ç§’çš„æœ€å°é—´éš”æ”¹ä¸ºå¯é…ç½®é¡¹
3. **äº‹ä»¶ç»Ÿè®¡**ï¼šæ·»åŠ äº‹ä»¶è§¦å‘ç»Ÿè®¡ï¼Œä¾¿äºŽç›‘æŽ§å’Œåˆ†æž
4. **å¤šå‘¨æœŸæ”¯æŒ**ï¼šè€ƒè™‘æ”¯æŒ15åˆ†é’Ÿã€1å°æ—¶ç­‰å…¶ä»–å‘¨æœŸçš„Kçº¿äº‹ä»¶è§¦å‘

### ç›¸å…³æ–‡ä»¶

- `market/monitor.go` - WebSocketç›‘æŽ§å’Œå›žè°ƒæœºåˆ¶
- `trader/auto_trader.go` - è‡ªåŠ¨äº¤æ˜“å™¨å’Œäº‹ä»¶å¤„ç†
- `market/types.go` - Kçº¿æ•°æ®ç»“æž„å®šä¹‰

---

## 2025-11-17 - å°†AIæ•°æ®ç‚¹æ•°é‡ä»Ž20ä¸ªå‡å°‘åˆ°10ä¸ªï¼ˆé™ä½ŽTokenæˆæœ¬ï¼‰

### é—®é¢˜æè¿°

- **é—®é¢˜**: ä¹‹å‰å°†æ•°æ®ç‚¹ä»Ž10ä¸ªå¢žåŠ åˆ°20ä¸ªï¼Œä½†åœ¨å®žé™…ä½¿ç”¨ä¸­å‘çŽ°20ä¸ªæ•°æ®ç‚¹ä»ç„¶å¯¼è‡´Tokenæ¶ˆè€—è¿‡é«˜
- **åŽŸå› **: 
  - æ¯ä¸ªæ—¶é—´æ¡†æž¶20ä¸ªæ•°æ®ç‚¹å¯¼è‡´Tokenæ¶ˆè€—ä»ç„¶è¾ƒé«˜
  - å¯¹äºŽå¤§å¤šæ•°åˆ†æžåœºæ™¯ï¼Œ10ä¸ªæ•°æ®ç‚¹å·²ç»è¶³å¤Ÿè¿›è¡ŒåŸºæœ¬çš„è¶‹åŠ¿å’Œå½¢æ€è¯†åˆ«
  - éœ€è¦è¿›ä¸€æ­¥é™ä½ŽTokenæ¶ˆè€—ä»¥æŽ§åˆ¶APIè°ƒç”¨æˆæœ¬
- **å½±å“**: 
  - Tokenæ¶ˆè€—ä»ç„¶è¾ƒé«˜ï¼Œå¢žåŠ APIè°ƒç”¨æˆæœ¬
  - å“åº”æ—¶é—´å¯èƒ½å˜é•¿
  - 10ä¸ªæ•°æ®ç‚¹å·²ç»è¶³å¤Ÿè¿›è¡ŒåŸºæœ¬çš„è¶‹åŠ¿å’Œå½¢æ€è¯†åˆ«

### ä¿®å¤æ–¹æ¡ˆ

å°†æ¯ä¸ªæ—¶é—´æ¡†æž¶çš„æ•°æ®ç‚¹æ•°é‡ä»Ž20ä¸ªè°ƒæ•´ä¸º10ä¸ªï¼Œåœ¨ä¿æŒåŸºæœ¬åˆ†æžèƒ½åŠ›çš„åŒæ—¶ï¼Œæ˜¾è‘—é™ä½ŽTokenæ¶ˆè€—ã€‚

### ä¿®æ”¹æ–‡ä»¶

#### `market/data.go`

##### 1. æ›´æ–°Kçº¿æ•°æ®èŽ·å–æ³¨é‡Šï¼ˆç¬¬34ã€52ã€58ã€64è¡Œï¼‰

**ä¿®æ”¹å‰**:
```go
// èŽ·å–3åˆ†é’ŸKçº¿æ•°æ®ï¼ˆèŽ·å–100ä¸ªç”¨äºŽè®¡ç®—æŒ‡æ ‡ï¼Œæœ€åŽ20ä¸ªä¼ é€’ç»™AIï¼‰
// èŽ·å–15åˆ†é’ŸKçº¿æ•°æ®ï¼ˆèŽ·å–100ä¸ªç”¨äºŽè®¡ç®—æŒ‡æ ‡ï¼Œæœ€åŽ20ä¸ªä¼ é€’ç»™AIï¼‰
// èŽ·å–1å°æ—¶Kçº¿æ•°æ®ï¼ˆèŽ·å–100ä¸ªç”¨äºŽè®¡ç®—æŒ‡æ ‡ï¼Œæœ€åŽ20ä¸ªä¼ é€’ç»™AIï¼‰
// èŽ·å–4å°æ—¶Kçº¿æ•°æ®ï¼ˆèŽ·å–100ä¸ªç”¨äºŽè®¡ç®—æŒ‡æ ‡ï¼Œæœ€åŽ20ä¸ªä¼ é€’ç»™AIï¼‰
```

**ä¿®æ”¹åŽ**:
```go
// èŽ·å–3åˆ†é’ŸKçº¿æ•°æ®ï¼ˆèŽ·å–100ä¸ªç”¨äºŽè®¡ç®—æŒ‡æ ‡ï¼Œæœ€åŽ10ä¸ªä¼ é€’ç»™AIï¼‰
// èŽ·å–15åˆ†é’ŸKçº¿æ•°æ®ï¼ˆèŽ·å–100ä¸ªç”¨äºŽè®¡ç®—æŒ‡æ ‡ï¼Œæœ€åŽ10ä¸ªä¼ é€’ç»™AIï¼‰
// èŽ·å–1å°æ—¶Kçº¿æ•°æ®ï¼ˆèŽ·å–100ä¸ªç”¨äºŽè®¡ç®—æŒ‡æ ‡ï¼Œæœ€åŽ10ä¸ªä¼ é€’ç»™AIï¼‰
// èŽ·å–4å°æ—¶Kçº¿æ•°æ®ï¼ˆèŽ·å–100ä¸ªç”¨äºŽè®¡ç®—æŒ‡æ ‡ï¼Œæœ€åŽ10ä¸ªä¼ é€’ç»™AIï¼‰
```

##### 2. ä¿®æ”¹ `calculateIntradaySeries` å‡½æ•°ï¼ˆç¬¬252-263è¡Œï¼‰

**ä¿®æ”¹å‰**:
```go
data := &IntradayData{
    MidPrices:     make([]float64, 0, 20),
    EMA20Values:   make([]float64, 0, 20),
    MACDValues:    make([]float64, 0, 20),
    RSI7Values:    make([]float64, 0, 20),
    RSI14Values:   make([]float64, 0, 20),
    Volumes:       make([]float64, 0, 20),
    BuySellRatios: make([]float64, 0, 20),
}

// èŽ·å–æœ€è¿‘20ä¸ªæ•°æ®ç‚¹ï¼ˆç”¨äºŽAIæ·±åº¦åˆ†æžï¼‰
start := len(klines) - 20
```

**ä¿®æ”¹åŽ**:
```go
data := &IntradayData{
    MidPrices:     make([]float64, 0, 10),
    EMA20Values:   make([]float64, 0, 10),
    MACDValues:    make([]float64, 0, 10),
    RSI7Values:    make([]float64, 0, 10),
    RSI14Values:   make([]float64, 0, 10),
    Volumes:       make([]float64, 0, 10),
    BuySellRatios: make([]float64, 0, 10),
}

// èŽ·å–æœ€è¿‘10ä¸ªæ•°æ®ç‚¹ï¼ˆç”¨äºŽAIæ·±åº¦åˆ†æžï¼‰
start := len(klines) - 10
```

##### 3. ä¿®æ”¹ `calculateLongerTermData` å‡½æ•°ï¼ˆç¬¬325-355è¡Œï¼‰

**ä¿®æ”¹å‰**:
```go
data := &LongerTermData{
    MidPrices:     make([]float64, 0, 20),
    EMA20Values:   make([]float64, 0, 20),
    MACDValues:    make([]float64, 0, 20),
    RSI7Values:    make([]float64, 0, 20),
    RSI14Values:   make([]float64, 0, 20),
    Volumes:       make([]float64, 0, 20),
    BuySellRatios: make([]float64, 0, 20),
}

// è®¡ç®—åºåˆ—æ•°æ®ï¼ˆèŽ·å–æœ€è¿‘20ä¸ªæ•°æ®ç‚¹ç”¨äºŽAIæ·±åº¦åˆ†æžï¼‰
start := len(klines) - 20
```

**ä¿®æ”¹åŽ**:
```go
data := &LongerTermData{
    MidPrices:     make([]float64, 0, 10),
    EMA20Values:   make([]float64, 0, 10),
    MACDValues:    make([]float64, 0, 10),
    RSI7Values:    make([]float64, 0, 10),
    RSI14Values:   make([]float64, 0, 10),
    Volumes:       make([]float64, 0, 10),
    BuySellRatios: make([]float64, 0, 10),
}

// è®¡ç®—åºåˆ—æ•°æ®ï¼ˆèŽ·å–æœ€è¿‘10ä¸ªæ•°æ®ç‚¹ç”¨äºŽAIæ·±åº¦åˆ†æžï¼‰
start := len(klines) - 10
```

#### `prompts/fusion_adaptive_taro.txt`

##### æ›´æ–°æ•°æ®ç‚¹æè¿°ï¼ˆç¬¬618è¡Œï¼‰

**ä¿®æ”¹å‰**:
```
**ðŸ“Š å››ä¸ªæ—¶é—´æ¡†æž¶åºåˆ—**ï¼ˆæ¯ä¸ªåŒ…å«æœ€è¿‘20ä¸ªæ•°æ®ç‚¹ï¼‰ï¼š
1. **3åˆ†é’Ÿåºåˆ—**ï¼šå®žæ—¶ä»·æ ¼ + æ”¾é‡åˆ†æžï¼ˆå½“å‰ä»·æ ¼ = æœ€åŽä¸€æ ¹Kçº¿çš„æ”¶ç›˜ä»·ï¼‰
   - Mid prices, EMA20, MACD, RSI7, RSI14
   - **Volumes**: æˆäº¤é‡åºåˆ—ï¼ˆç”¨äºŽæ£€æµ‹æ”¾é‡ï¼‰
   - **BuySellRatios**: ä¹°å–åŽ‹åŠ›æ¯”ï¼ˆ>0.6å¤šæ–¹å¼ºï¼Œ<0.4ç©ºæ–¹å¼ºï¼‰
2. **15åˆ†é’Ÿåºåˆ—**ï¼šçŸ­æœŸéœ‡è¡åŒºé—´è¯†åˆ«ï¼ˆè¦†ç›–æœ€è¿‘5å°æ—¶ï¼‰
   - Mid prices, EMA20, MACD, RSI7, RSI14
3. **1å°æ—¶åºåˆ—**ï¼šä¸­æœŸæ”¯æ’‘åŽ‹åŠ›ç¡®è®¤ï¼ˆè¦†ç›–æœ€è¿‘20å°æ—¶ï¼‰
   - Mid prices, EMA20, MACD, RSI7, RSI14
4. **4å°æ—¶åºåˆ—**ï¼šå¤§è¶‹åŠ¿é¢„è­¦ï¼ˆè¦†ç›–æœ€è¿‘80å°æ—¶ï¼Œçº¦3.3å¤©ï¼‰
   - Mid prices, EMA20, MACD, RSI7, RSI14
```

**ä¿®æ”¹åŽ**:
```
**ðŸ“Š å››ä¸ªæ—¶é—´æ¡†æž¶åºåˆ—**ï¼ˆæ¯ä¸ªåŒ…å«æœ€è¿‘10ä¸ªæ•°æ®ç‚¹ï¼‰ï¼š
1. **3åˆ†é’Ÿåºåˆ—**ï¼šå®žæ—¶ä»·æ ¼ + æ”¾é‡åˆ†æžï¼ˆå½“å‰ä»·æ ¼ = æœ€åŽä¸€æ ¹Kçº¿çš„æ”¶ç›˜ä»·ï¼‰
   - Mid prices, EMA20, MACD, RSI7, RSI14
   - **Volumes**: æˆäº¤é‡åºåˆ—ï¼ˆç”¨äºŽæ£€æµ‹æ”¾é‡ï¼‰
   - **BuySellRatios**: ä¹°å–åŽ‹åŠ›æ¯”ï¼ˆ>0.6å¤šæ–¹å¼ºï¼Œ<0.4ç©ºæ–¹å¼ºï¼‰
2. **15åˆ†é’Ÿåºåˆ—**ï¼šçŸ­æœŸéœ‡è¡åŒºé—´è¯†åˆ«ï¼ˆè¦†ç›–æœ€è¿‘2.5å°æ—¶ï¼‰
   - Mid prices, EMA20, MACD, RSI7, RSI14
3. **1å°æ—¶åºåˆ—**ï¼šä¸­æœŸæ”¯æ’‘åŽ‹åŠ›ç¡®è®¤ï¼ˆè¦†ç›–æœ€è¿‘10å°æ—¶ï¼‰
   - Mid prices, EMA20, MACD, RSI7, RSI14
4. **4å°æ—¶åºåˆ—**ï¼šå¤§è¶‹åŠ¿é¢„è­¦ï¼ˆè¦†ç›–æœ€è¿‘40å°æ—¶ï¼Œçº¦1.7å¤©ï¼‰
   - Mid prices, EMA20, MACD, RSI7, RSI14
```

#### `prompts/fusion_adaptive_taro_compact-v1.txt`

##### æ›´æ–°æ•°æ®ç‚¹æè¿°ï¼ˆç¬¬145è¡Œï¼‰

**ä¿®æ”¹å‰**:
```
å¯ç”¨æ•°æ®ï¼š3m/15m/1h/4håºåˆ—(æ¯ä¸ª20ä¸ªæ•°æ®ç‚¹)- Mid prices, EMA20, MACD, RSI7, RSI14, Volumes, BuySellRatios
```

**ä¿®æ”¹åŽ**:
```
å¯ç”¨æ•°æ®ï¼š3m/15m/1h/4håºåˆ—(æ¯ä¸ª10ä¸ªæ•°æ®ç‚¹)- Mid prices, EMA20, MACD, RSI7, RSI14, Volumes, BuySellRatios
```

#### `prompts/fusion_adaptive_taro_compact-v2.txt`

##### æ›´æ–°æ•°æ®ç‚¹æè¿°ï¼ˆç¬¬129è¡Œï¼‰

**ä¿®æ”¹å‰**:
```
å¯ç”¨æ•°æ®ï¼š3m/15m/1h/4håºåˆ—(æ¯ä¸ª20ä¸ªæ•°æ®ç‚¹)- Mid prices, EMA20, MACD, RSI7, RSI14, Volumes, BuySellRatios
```

**ä¿®æ”¹åŽ**:
```
å¯ç”¨æ•°æ®ï¼š3m/15m/1h/4håºåˆ—(æ¯ä¸ª10ä¸ªæ•°æ®ç‚¹)- Mid prices, EMA20, MACD, RSI7, RSI14, Volumes, BuySellRatios
```

### æ•°æ®é‡å¯¹æ¯”

| æ—¶é—´æ¡†æž¶ | ä¿®æ”¹å‰ï¼ˆ20ä¸ªï¼‰ | ä¿®æ”¹åŽï¼ˆ10ä¸ªï¼‰ | æ—¶é—´è¦†ç›–å˜åŒ– |
|---------|--------------|--------------|------------|
| 3åˆ†é’Ÿ   | 20ä¸ª | **10ä¸ª** | 1å°æ—¶ â†’ **0.5å°æ—¶** |
| 15åˆ†é’Ÿ  | 20ä¸ª | **10ä¸ª** | 5å°æ—¶ â†’ **2.5å°æ—¶** |
| 1å°æ—¶   | 20ä¸ª | **10ä¸ª** | 20å°æ—¶ â†’ **10å°æ—¶** |
| 4å°æ—¶   | 20ä¸ª | **10ä¸ª** | 80å°æ—¶ï¼ˆçº¦3.3å¤©ï¼‰ â†’ **40å°æ—¶ï¼ˆçº¦1.7å¤©ï¼‰** |

### Tokenæ¶ˆè€—å½±å“

- **ä¿®æ”¹å‰ï¼ˆ20ä¸ªæ•°æ®ç‚¹ï¼‰**ï¼šçº¦ 5,600 tokensï¼ˆ4ä¸ªæ—¶é—´æ¡†æž¶ Ã— 20ä¸ªæ•°æ®ç‚¹ï¼‰
- **ä¿®æ”¹åŽï¼ˆ10ä¸ªæ•°æ®ç‚¹ï¼‰**ï¼šçº¦ 2,800 tokensï¼ˆ4ä¸ªæ—¶é—´æ¡†æž¶ Ã— 10ä¸ªæ•°æ®ç‚¹ï¼‰
- **å‡å°‘**ï¼šçº¦50%çš„Tokenæ¶ˆè€—
- **æˆæœ¬å½±å“**ï¼šæ˜¾è‘—é™ä½ŽAPIè°ƒç”¨æˆæœ¬ï¼ŒåŒæ—¶ä¿æŒåŸºæœ¬çš„åˆ†æžèƒ½åŠ›

### å½±å“èŒƒå›´

#### ä¼˜ç‚¹
- âœ… Tokenæ¶ˆè€—é™ä½Žçº¦50%ï¼Œæ˜¾è‘—èŠ‚çœæˆæœ¬
- âœ… å“åº”æ—¶é—´æ›´å¿«
- âœ… 10ä¸ªæ•°æ®ç‚¹ä»è¶³å¤Ÿè¿›è¡ŒåŸºæœ¬çš„è¶‹åŠ¿å’Œå½¢æ€è¯†åˆ«
- âœ… å¯¹äºŽå¤§å¤šæ•°äº¤æ˜“åœºæ™¯ï¼Œ10ä¸ªæ•°æ®ç‚¹å·²ç»è¶³å¤Ÿ

#### æƒè¡¡
- âš ï¸ æ•°æ®ç‚¹å‡å°‘å¯èƒ½å¯¼è‡´æŸäº›å¤æ‚å½¢æ€è¯†åˆ«èƒ½åŠ›ç•¥é™
- âš ï¸ æ—¶é—´è¦†ç›–èŒƒå›´ç¼©å°ï¼Œä½†å¯¹äºŽå¤§å¤šæ•°åœºæ™¯ä»ç„¶è¶³å¤Ÿ
- âš ï¸ é•¿æœŸè¶‹åŠ¿åˆ†æžèƒ½åŠ›å¯èƒ½ç•¥æœ‰ä¸‹é™

### è¯´æ˜Ž

æ­¤æ¬¡è°ƒæ•´æ˜¯åœ¨å®žé™…ä½¿ç”¨åŽæ ¹æ®æˆæœ¬å’Œæ•ˆæžœå¹³è¡¡åšå‡ºçš„ä¼˜åŒ–å†³ç­–ï¼š
- 20ä¸ªæ•°æ®ç‚¹è™½ç„¶æä¾›äº†æ›´å…¨é¢çš„åˆ†æžèƒ½åŠ›ï¼Œä½†Tokenæ¶ˆè€—ä»ç„¶è¿‡é«˜
- 10ä¸ªæ•°æ®ç‚¹åœ¨ä¿æŒåŸºæœ¬åˆ†æžèƒ½åŠ›çš„åŒæ—¶ï¼Œæ˜¾è‘—é™ä½Žäº†æˆæœ¬ï¼ˆç›¸æ¯”20ä¸ªå‡å°‘50%ï¼‰
- è¿™æ˜¯ä¸€ä¸ªåœ¨åŠŸèƒ½æ€§å’Œæˆæœ¬ä¹‹é—´çš„å¹³è¡¡é€‰æ‹©
- å¦‚æžœåŽç»­å‘çŽ°10ä¸ªæ•°æ®ç‚¹ä¸è¶³ï¼Œå¯ä»¥å†æ¬¡è°ƒæ•´

### æµ‹è¯•å»ºè®®

1. éªŒè¯æ¯ä¸ªæ—¶é—´æ¡†æž¶çš„æ•°æ®ç‚¹æ•°é‡æ˜¯å¦ç¡®å®žæ˜¯10ä¸ª
2. ç›‘æŽ§Tokenæ¶ˆè€—ï¼ŒéªŒè¯æˆæœ¬é™ä½Žæ•ˆæžœ
3. è§‚å¯ŸAIå†³ç­–è´¨é‡ï¼Œç¡®è®¤10ä¸ªæ•°æ®ç‚¹æ˜¯å¦è¶³å¤Ÿ
4. å¯¹æ¯”äº¤æ˜“æ•ˆæžœï¼Œè¯„ä¼°åˆ†æžèƒ½åŠ›æ˜¯å¦å—åˆ°å½±å“

---

## æ€»ç»“

æœ¬æ¬¡ä¿®æ”¹å®žçŽ°äº†**äº‹ä»¶é©±åŠ¨å†³ç­–æœºåˆ¶**ï¼Œè§£å†³äº†å†³ç­–æ»žåŽé—®é¢˜ã€‚é€šè¿‡åœ¨æ–°3åˆ†é’ŸKçº¿å½¢æˆæ—¶ç«‹å³è§¦å‘å†³ç­–ï¼Œå°†å†³ç­–å»¶è¿Ÿä»Žæœ€å¤š3åˆ†é’Ÿé™ä½Žåˆ°æ•°ç§’å†…ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œäº¤æ˜“æ—¶æœºæ•æ‰èƒ½åŠ›ã€‚åŒæ—¶ä¿ç•™äº†å®šæ—¶å™¨ä½œä¸ºå…œåº•æœºåˆ¶ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

æ­¤å¤–ï¼Œä¸ºäº†è¿›ä¸€æ­¥é™ä½ŽTokenæˆæœ¬ï¼Œå°†AIæ•°æ®ç‚¹æ•°é‡ä»Ž20ä¸ªå‡å°‘åˆ°10ä¸ªï¼ŒTokenæ¶ˆè€—é™ä½Žçº¦50%ï¼Œåœ¨ä¿æŒåŸºæœ¬åˆ†æžèƒ½åŠ›çš„åŒæ—¶æ˜¾è‘—èŠ‚çœäº†APIè°ƒç”¨æˆæœ¬ã€‚

